<?xml version="1.0" encoding="UTF-8"?>

<component name="ca.firstvoices.chains.contrib" version="1.0.0">
<extension target="org.nuxeo.ecm.core.operation.OperationServiceComponent" point="chains">
  <chain id="EH_FVPartOfSpeechFillTitle">
    <operation id="Context.FetchDocument"/>
    <operation id="Document.SetProperty">
      <param type="string" name="xpath">dc:title</param>
      <param type="boolean" name="save">true</param>
      <param type="serializable" name="value">expr:Document.parent.title</param>
    </operation>
    <operation id="Document.GetChildren"/>
  </chain>
  <chain id="EH_RelateWordToPicture">
    <operation id="Context.FetchDocument"/>
    <operation id="javascript.FVRelatePicture"/>
  </chain>
  <chain id="FVCreateDefaultDialectGroups">
    <operation id="Context.FetchDocument"/>
    <operation id="FVDialectRegularDocumentPermissions"/>
    <operation id="Document.Save"/>
  </chain>
  <chain id="FVCreateDefaultPublishedDialectGroups">
    <operation id="Context.FetchDocument"/>
    <operation id="FVDialectPublishedDocumentPermissions"/>
    <operation id="Document.Save"/>
  </chain>
  <chain id="FVDisableDocument">
    <operation id="Context.FetchDocument"/>
    <operation id="Document.FollowLifecycleTransition">
      <param type="string" name="value">Disable</param>
    </operation>
    <operation id="Audit.LogEvent">
      <param type="string" name="event">expr:Document disabled by @{CurrentUser.firstName}
        @{CurrentUser.lastName} (@{CurrentUser.name})
      </param>
      <param type="string" name="category">Automation</param>
    </operation>
  </chain>
  <chain id="FVEnableDocument">
    <operation id="Context.FetchDocument"/>
    <operation id="Document.FollowLifecycleTransition">
      <param type="string" name="value">Enable</param>
    </operation>
    <operation id="Audit.LogEvent">
      <param type="string" name="event">expr:Document enabled by @{CurrentUser.firstName}
        @{CurrentUser.lastName} (@{CurrentUser.name})
      </param>
      <param type="string" name="category">Automation</param>
    </operation>
  </chain>
  <chain id="FVEnableLanguageAssetRequested">
    <operation id="Context.FetchDocument"/>
    <operation id="Audit.LogEvent">
      <param type="string" name="event">expr:Request to enable from @{CurrentUser.name}</param>
      <param type="string" name="category">Automation</param>
    </operation>
  </chain>
  <chain id="FVGetApproverGroups">
    <operation id="Context.FetchDocument"/>
    <operation id="Context.RestoreDocumentInputFromScript">
      <param type="string" name="script">This[0]</param>
    </operation>
    <operation id="Context.GetUsersGroupIdsWithPermissionOnDoc">
      <param type="string" name="permission">Approve</param>
      <param type="string" name="variable name">groups_with_approval_for_document</param>
      <param type="boolean" name="ignore groups">false</param>
      <param type="boolean" name="prefix identifiers">true</param>
      <param type="boolean" name="resolve groups">false</param>
    </operation>
    <operation id="Workflow.SetNodeVariable">
      <param type="string" name="name">assignees</param>
      <param type="object" name="value">expr:groups_with_approval_for_document</param>
    </operation>
  </chain>
  <chain id="FVPublish">
    <operation id="Context.FetchDocument"/>
    <operation id="javascript.FVPublishOrRepublish"/>
  </chain>
  <chain id="FVPublishCategoryParents">
    <operation id="Context.FetchDocument"/>
    <operation id="FVPublishParents">
      <param type="string" name="stopDocumentType">FVCategories</param>
    </operation>
    <operation id="Document.Save"/>
  </chain>
  <chain id="FVPublishFromWorklist">
    <operation id="Seam.FetchFromWorklist"/>
    <operation id="Document.FollowLifecycleTransition">
      <param type="string" name="value">Publish</param>
    </operation>
  </chain>
  <chain id="FVSaveAndPublish">
    <operation id="Context.FetchDocument"/>
    <operation id="Document.Save"/>
    <operation id="javascript.FVPublishOrRepublish"/>
    <operation id="WebUI.NavigateTo"/>
  </chain>
  <chain id="FVSimplePublish">
    <operation id="Context.FetchDocument"/>
    <operation id="Document.FollowLifecycleTransition">
      <param type="string" name="value">Publish</param>
    </operation>
  </chain>
  <chain id="FVUnpublishDialect">
    <operation id="Context.FetchDocument"/>
    <operation id="Document.FollowLifecycleTransition">
      <param type="string" name="value">Unpublish</param>
    </operation>
  </chain>
  <chain id="INCreateVerbEnding">
    <operation id="WebUI.ShowCreateForm">
      <param type="string" name="type">INVerbEnding</param>
    </operation>
  </chain>
  <chain id="voidChain">
    <operation id="Context.FetchDocument"/>
  </chain>
</extension>
</component>